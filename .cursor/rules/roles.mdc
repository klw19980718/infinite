
alwaysApply: true
---

# 00-core — Core Rules (Infinite Talk)

## 项目事实（请勿假设）
- Stack: Next.js 15.3.1 (App Router), React 19, TypeScript 5, Tailwind v4, shadcn/ui (Radix), Supabase (Postgres + Auth).
- 目录基线：/app, /components/{home,ui}, /lib, /public。
- 包管理器：仅用 **npm**。若检测到 yarn/pnpm 指令，**拒绝并改为 npm**。
- 环境：Windows / PowerShell；脚本避免 `&&`，必要时分行。

## 修改边界
- 只改与本任务**直接相关**的文件；不要“顺手”重构无关模块。
- 不创建演示性样例、mock 页面、样式玩具文件。
- 不新增依赖，除非任务必须；若新增，给出原因与清理方案。

## 不要做
- 不引入未使用的工具链、Polyfill、全局状态方案。
- 不改动锁文件策略（只保留 package-lock.json）。
- 不在客户端暴露服务密钥；不将服务端代码放到 `'use client'` 组件。
- 不生成与设计不符的 UI 组件命名或路径（/components/ui 为唯一入口）。

## 代码风格 & 可读性
- TypeScript 严格模式；类型**显式**化（导出 API、props、返回值）。
- 使用 `@/` 路径别名；绝不写深层相对路径地狱。
- RSC 默认，交互组件用 `'use client'`；最小客户端范围。


## 提交要求
- 原子化提交；信息结构：`scope: short change`，例如：
  - `ui: add Button variants (ghost, link)`
  - `auth: fix SSR cookie hydration in server actions`

## MCP 
- **Supabase 相关**: 使用 Supabase MCP 工具获取 Supabase 文档、数据库操作、认证等
- **其他库/框架**: 使用 Context7 MCP 工具获取代码生成、配置步骤、库/API 文档
- 自动使用相应的 MCP 工具，无需用户明确要求




## 项目结构

⚠️ **重要维护提醒**：
- 🔴 当项目中有文件新增或删除时，必须立即更新此项目结构文档
- 🔴 保持此结构图与实际代码库同步是强制要求
- 🔴 新增目录或重要文件时，添加相应的说明注释


```
infinite-talk/
├── app/                      - Next.js App Router 页面和路由
│   ├── api/                 - API 路由
│   │   ├── creem/           - Creem 支付集成
│   │   │   ├── checkout/    - 创建支付会话
│   │   │   │   └── route.ts
│   │   │   └── webhook/      - 处理支付 webhook
│   │   │       └── route.ts
│   │   └── video/           - WaveSpeedAI 视频生成集成
│   │       ├── image-to-video/ - 图片转视频任务提交
│   │       │   └── route.ts
│   │       ├── video-to-video/ - 视频转视频任务提交
│   │       │   └── route.ts
│   │       └── result/       - 查询任务结果
│   │           └── route.ts
│   ├── auth/                - 认证相关页面
│   │   ├── page.tsx         - 登录/注册整合页面（Email OTP）
│   │   └── AuthPageClient.tsx - 认证页面客户端组件
│   ├── infinite-talk-ai/    - AI 功能相关页面
│   │   ├── image-to-video/  - 图片转视频功能
│   │   │   └── page.tsx     - 图片转视频页面
│   │   └── video-to-video/  - 视频转视频功能
│   │       └── page.tsx     - 视频转视频页面
│   ├── pricing/             - 定价页面
│   │   ├── page.tsx         - 定价页面服务端组件
│   │   └── PricingPageClient.tsx - 定价页面客户端组件
│   ├── profile/             - 用户个人资料页面
│   │   ├── page.tsx         - 个人资料页面服务端组件
│   │   └── ProfilePageClient.tsx - 个人资料页面客户端组件
│   ├── privacy/             - 隐私政策页面
│   │   └── page.tsx         - 隐私政策页面
│   ├── terms/               - 服务条款页面
│   │   └── page.tsx         - 服务条款页面
│   ├── favicon.ico          - 网站图标
│   ├── globals.css          - 全局样式文件
│   ├── layout.tsx           - 根布局组件（含导航栏和页脚）
│   ├── not-found.tsx        - 404 页面
│   ├── page.tsx             - 首页（主页面）
│   └── sitemap.ts           - 站点地图配置
│
├── components/               - React 组件目录
│   ├── auth/                - 认证相关组件
│   │   ├── LoginDialog.tsx  - 登录弹窗组件
│   │   ├── OtpForm.tsx      - Email OTP 表单（可复用）
│   │   └── UserMenu.tsx     - 用户头像下拉菜单
│   ├── home/                - 首页相关组件
│   │   ├── FAQ.tsx          - 常见问题组件
│   │   ├── hero.tsx         - 首屏英雄区组件
│   │   ├── Highlights.tsx   - 亮点展示组件
│   │   ├── HowItWorks.tsx   - 工作原理说明组件
│   │   ├── Specs.tsx        - 规格参数组件
│   │   ├── UnderTheHood.tsx - 技术细节组件
│   │   └── index.ts         - 组件统一导出
│   ├── image-to-video/      - 图片转视频相关组件
│   │   ├── AudioWaveform.tsx - 音频波形可视化组件
│   │   ├── AvatarDialog.tsx - 头像选择对话框组件
│   │   ├── cta.tsx          - 行动号召组件
│   │   ├── hero.tsx         - 图片转视频英雄区组件
│   │   ├── RecordAudioDialog.tsx - 录音对话框组件
│   │   ├── TalkingPhotoLayout.tsx - 图片转视频布局组件（包含图片上传、音频处理、模型选择等）
│   │   ├── VoiceSelectDialog.tsx - 声音选择对话框组件
│   │   └── index.ts         - 组件统一导出
│   ├── video-to-video/      - 视频转视频相关组件
│   │   ├── hero.tsx         - 视频转视频英雄区组件
│   │   └── index.ts         - 组件统一导出
│   ├── ui/                  - 可复用 UI 组件（shadcn/ui 风格）
│   │   ├── avatar.tsx       - 头像组件
│   │   ├── beams.tsx        - 光束效果组件
│   │   ├── button.tsx       - 按钮组件
│   │   ├── card.tsx         - 卡片组件
│   │   ├── dialog.tsx       - 对话框组件
│   │   ├── dropdown-menu.tsx - 下拉菜单组件
│   │   ├── input.tsx        - 输入框组件
│   │   ├── label.tsx        - 标签组件
│   │   ├── sheet.tsx        - 侧边栏组件
│   │   ├── slider.tsx       - 滑块组件
│   │   ├── sonner.tsx       - Toast 通知组件
│   │   ├── tabs.tsx         - 标签页组件
│   │   ├── textarea.tsx     - 文本域组件
│   │   └── theme-toggle.tsx - 主题切换组件
│   ├── Footer.tsx           - 页脚组件（含品牌信息和链接）
│   └── nav.tsx              - 导航栏组件（含Logo和登录/用户菜单）
│
├── components.json          - shadcn/ui 组件配置文件
│
├── lib/                     - 工具函数和配置
│   ├── supabase/            - Supabase 客户端配置
│   │   └── server.server.ts - 服务端 Supabase 客户端（从 cookie 读取 session，用于 Server Components、Server Actions、API Route Handlers）
│   ├── supabase.ts          - Supabase 客户端单例（客户端组件使用）
│   ├── wavespeed.ts         - WaveSpeedAI API 工具函数
│   └── utils.ts             - 通用工具函数（cn, clsx 等）
│
├── doc/                     - 项目文档目录
│   ├── CREEM_SETUP.md       - Creem 支付集成配置文档
│   ├── CREEM_TEST_MODE_WEBHOOK.md - Creem 测试模式 Webhook 配置
│   ├── ENV_SETUP.md         - 环境变量配置文档
│   └── WEBHOOK_LOCAL_SETUP.md - 本地 Webhook 测试配置文档
│
├── public/                  - 静态资源目录
│   ├── audio/               - 音频相关资源
│   │   ├── voice/           - 声音样本文件目录（包含音频文件和封面图片）
│   │   └── voices.json      - 声音数据配置文件（包含声音列表、标签、音频文件路径等）
│   ├── google32aec5a0f4af8f9d.html - Google 验证文件
│   ├── llms.txt             - LLM 相关文档
│   ├── logo.png             - 网站 Logo
│   └── robots.txt           - 搜索引擎爬虫配置
│
├── .cursor/                 - Cursor IDE 配置
│   └── rules/               - Cursor Rules 规则文件
│
├── node_modules/            - NPM 依赖包（不提交）
│
├── LICENSE                  - 项目许可证
├── next-env.d.ts            - Next.js TypeScript 声明
├── next.config.ts           - Next.js 配置文件
├── package.json             - 项目依赖配置
├── package-lock.json        - NPM 依赖锁定文件
├── yarn.lock                - Yarn 依赖锁定文件
├── postcss.config.mjs       - PostCSS 配置
├── tailwind.config.js       - Tailwind CSS 配置
├── tsconfig.json            - TypeScript 配置
├── tsconfig.tsbuildinfo     - TypeScript 构建缓存
└── test-webhook-debug.js    - Webhook 测试调试脚本（开发用）
```


